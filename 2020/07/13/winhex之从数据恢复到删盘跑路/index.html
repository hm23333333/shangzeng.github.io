<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="ShangZeng">





<title>winhex之从数据恢复到删盘跑路 | ShangZeng</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">ShangZeng&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                    <a class="menu-item" href="/friends">Friends</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">ShangZeng&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                    <a class="menu-item" href="/friends">Friends</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">winhex之从数据恢复到删盘跑路</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">ShangZeng</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">July 13, 2020&nbsp;&nbsp;17:44:07</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/other/">other</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>大学打取证比赛学的技能，属于炒冷饭了。这里就是记录下。</p>
<p><a href="https://mp.weixin.qq.com/s/Fw9zbUMt0qp5JMEpyfzxRg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/Fw9zbUMt0qp5JMEpyfzxRg</a></p>
<h3 id="什么是WINHEX"><a href="#什么是WINHEX" class="headerlink" title="什么是WINHEX"></a>什么是WINHEX</h3><p>WINHEX 是一款用于查看和编辑底层十六进制数据的软件，我们可以利用这个软件修改文件格式数据，从而达到数据恢复的效果。<br>当然，WINHEX也不仅仅用于数据恢复，也可以用于磁盘恢复，RAID重组，镜像转换，CTF 隐写杂项等等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">下载网址： https:&#x2F;&#x2F;www.x-ways.net&#x2F;winhex&#x2F;index-m.html</span><br></pre></td></tr></table></figure>
<p>WINHEX 支持中文，在设置栏中进行修改：</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/1.png" alt="image"></p>
<p>WINHEX 基本界面如下，我们数据恢复用到的功能很少因此只介绍一部分。</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/2.png" alt="image"></p>
<p>在安装和了解WINHEX的基本结构后，我们就可以愉快的进行数（删）据（盘）恢（跑）复（路）了。</p>
<h3 id="winhex自动数据恢复"><a href="#winhex自动数据恢复" class="headerlink" title="winhex自动数据恢复"></a>winhex自动数据恢复</h3><p>如同字面意思一样，自动恢复就是利用HINHEX 自动在存储数据的扇区中搜索文件类型（根据文件头进行判断），并自动进行查找数据进行恢复。自动回复不需要我们掌握技术原理，操作方式如下：</p>
<p>首先打开你错删文件存储的磁盘，我这里删除的是C盘的文件，因此需要打开的C盘：</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/3.png" alt="image"></p>
<p>然后选择工具 -&gt; 磁盘工具 -&gt; 按文件类型进行恢复<br>这里要注意恢复的文件最好是在一个新的磁盘中，以免造成文件覆盖。</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/4.png" alt="image"></p>
<p>选中我们要恢复的数据类型（可以多选），选中输出目录，点击确定：</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/5.png" alt="image"></p>
<p>恢复速度和磁盘大小有关，耐心等待数据恢复就好：</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/6.png" alt="image"></p>
<p>虽然恢复出来了，但是问题还是有很多的： 按照文件类型恢复的数据量多而复杂（因为是无差别寻找），在其中查找我们想要的数据也要花费不少时间；按照文件类型恢复的数据名会丢失（因为在文件系统中，数据内容和数据名不是存放在一个地方）。<br>因此，如果我们想完整的恢复特定的文件，还是需要进行手动操作恢复的。而在进行手动恢复之前，我们需要了解以下基础知识。</p>
<h4 id="什么是文件系统"><a href="#什么是文件系统" class="headerlink" title="什么是文件系统"></a>什么是文件系统</h4><p>就像电脑对应的操作系统一样，我们日常使用的移动介质中，也存在相应的文件系统，每种文件系统有自己的存储方式（大同小异），而比较常见的文件系统如下：</p>
<ol>
<li>FAT32/64  常见于U盘，内存卡等文件系统</li>
<li>NTFS  WIN的文件系统</li>
<li>APFS   MAC的文件系统</li>
</ol>
<p>由于文章篇幅原因，这里我们只讲解最常见的HTFS文件系统，也就是使用WINHEX基于WINDOWS的数据恢复。既然我们知道数据是存储在NTFS系统中，那么我们就要了解下NTFS文件系统的存储规则。</p>
<h4 id="NTFS-文件存储规则"><a href="#NTFS-文件存储规则" class="headerlink" title="NTFS 文件存储规则"></a>NTFS 文件存储规则</h4><p>在使用WINHEX查看NTFS文件系统的时候，我们能看见一些以$开头的文件，这些文件就是NTFS操作系统的元文件，元文件用于管理存储介质中的内容：</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/7.png" alt="image"></p>
<p>在NTFS文件系统的结构如下：</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/8.png" alt="image"></p>
<p>其中每个元文件的功能如下：</p>
<ol>
<li>$MFT  又叫主文件表，用于存储数据名和文件区间的索引（简单理解就是这里存放着文件名信息在内的文件属性信息，是我们数据恢复重点关注的对象）。</li>
<li>$MFTMIRR   就是$MFT的备份文件（但是只备份一部分）</li>
<li>$BOOT 引导文件，记录了用于引导的数据</li>
<li>$DBR 备份文件 ，其中$DBR 源文件在0号扇区</li>
</ol>
<h4 id="MFT-元文件结构"><a href="#MFT-元文件结构" class="headerlink" title="$MFT 元文件结构"></a>$MFT 元文件结构</h4><p>上文我们知道文件属性存储在$MFT，那么接下来我们需要了解部分数据属性具体在$MFT 中的存储状况：</p>
<table>
<thead>
<tr>
<th>$MFT结构</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>10属性</td>
<td>文件标准信息（创建/修改时间等等）</td>
</tr>
<tr>
<td>30属性</td>
<td>存储文件名属性（主要是文件名）</td>
</tr>
<tr>
<td>80属性</td>
<td>存储文件数据内容信息（数据过大会存储地址）</td>
</tr>
</tbody></table>
<p>在WINHEX中表现如下：</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/9.png" alt="image"></p>
<p>其中文件名是存储在30属性中的，而文件内容是存储在80属性中，然而80属性的容量一般无法存储文件所有的数据，因此，这里涉及到了一个“簇流运行”的概念。</p>
<h4 id="什么是簇流运行"><a href="#什么是簇流运行" class="headerlink" title="什么是簇流运行"></a>什么是簇流运行</h4><p>“簇流”是指存放数据的一块区域，而“簇流运行”就是指记录“簇流”文件具体在那个位置的数据（这里涉及了80属性的一个“常驻属性”和“非常驻属性”的概念）。<br>简单说，“簇流运行”就是指文件存储位置的一段字节。而“簇流运行”中存储数据有自己的一套规则。举个例子，某“簇流运行”结构如下：</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/10.png" alt="image"></p>
<h4 id="删除文件后NTFS的变化"><a href="#删除文件后NTFS的变化" class="headerlink" title="删除文件后NTFS的变化"></a>删除文件后NTFS的变化</h4><p>在我们彻底删除一个文件后，在NTFS中到底是有什么变化呢？</p>
<p>在彻底删除一个文件后，只是在$MFT    中的10属性发生变化了，表示这个文件可以被写入数据（这也是为什么我们不建议对要数据恢复的磁盘进行写入操作的原因，害怕会覆盖掉我们要进行数据恢复的文件）。但是数据和数据属性仍然存在。也就是数据恢复的基础。</p>
<p>了解NTFS文件的存储规律后，接下来数据恢复的思路就很明显了：我们使用WINHEX定位到MFT或者MFTMIRR文件，再从MFT/MFTMIRR文件中找到要恢复的文件属性和数据存储扇区，导出扇区中的数据进行数据恢复了。</p>
<p>可能听起来有点懵逼，所以我们接下来手动尝试一遍。</p>
<h3 id="使用winhex手工数据恢复"><a href="#使用winhex手工数据恢复" class="headerlink" title="使用winhex手工数据恢复"></a>使用winhex手工数据恢复</h3><p>首先，shift+delect彻底删除一张图片作为数据恢复的对象</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/11.png" alt="image"></p>
<p>使用winhex 打开被删除文件的磁盘，定位到$MFT 项目，使用winhex搜索文件名：WechatIMG648.jpeg  转换为十六进制：</p>
<p>点击任务栏中的查找十六进制数值，搜索十六进制的文件名，选择向下搜索，点击确定。</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/12.png" alt="image"></p>
<p>找到文件80属性，找到簇流运行的文件</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/13.png" alt="image"></p>
<p>5DECCA（这里读取扇区是需要倒着顺序的）转换成十进制为6155466，使用winhex跳转</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/14.png" alt="image"></p>
<p>这里我们看到JFIF文件头就能判断是文件开头了，而文件大小是09，转换成十进制也是09，这里我们首先右键，选择标记为文件起始块：</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/15.png" alt="image"></p>
<p>跳转到文件结尾（6155466+9），扇区，右键选择结尾。右键选择编辑，置入新文件,保存。</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/16.png" alt="image"></p>
<p>接下来就能看见我们数据恢复出来的文件了～</p>
<p><img src="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/17.png" alt="image"></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>ShangZeng</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/">https://www.shangzeng.club/2020/07/13/winhex%E4%B9%8B%E4%BB%8E%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%88%B0%E5%88%A0%E7%9B%98%E8%B7%91%E8%B7%AF/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2020 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY<strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/"># 数据恢复</a>
                    
                        <a href="/tags/winhex/"># winhex</a>
                    
                        <a href="/tags/other/"># other</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/07/13/Golang%E4%B9%8BHTTP%E8%AF%B7%E6%B1%82/">Golang之HTTP请求</a>
            
            
            <a class="next" rel="next" href="/2020/07/13/%E9%92%93%E9%B1%BC-BADUSB%E6%B5%8B%E8%AF%95%E9%83%A8%E7%BD%B2/">钓鱼邮件/网站+BADUSB测试部署</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© ShangZeng | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
